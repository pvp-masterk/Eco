<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Economy Simulator Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --accent: #4895ef;
            --dark: #2b2d42;
            --light: #f8f9fa;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #f8961e;
            --info: #560bad;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s ease;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: var(--dark);
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            margin-bottom: 30px;
            animation: fadeInDown 0.5s ease;
        }
        
        .logo {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
        }
        
        .logo span {
            color: var(--accent);
        }
        
        .auth-section {
            display: flex;
            gap: 15px;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-secondary {
            background-color: var(--secondary);
            color: white;
        }
        
        .btn-accent {
            background-color: var(--accent);
            color: white;
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .btn-success {
            background-color: var(--success);
            color: white;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 3fr;
            gap: 30px;
            animation: fadeIn 0.8s ease;
        }
        
        .sidebar {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 15px rgba(0,0,0,0.05);
            height: fit-content;
        }
        
        .sidebar-menu {
            list-style: none;
        }
        
        .sidebar-menu li {
            margin-bottom: 15px;
        }
        
        .sidebar-menu a {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            border-radius: 8px;
            color: var(--dark);
            text-decoration: none;
            font-weight: 500;
        }
        
        .sidebar-menu a:hover, .sidebar-menu a.active {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary);
        }
        
        .sidebar-menu i {
            font-size: 20px;
        }
        
        .dashboard {
            display: grid;
            gap: 30px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 10px 15px rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: var(--primary);
        }
        
        .stat-card h3 {
            font-size: 16px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .stat-card p {
            font-size: 28px;
            font-weight: 700;
            color: var(--dark);
        }
        
        .stat-card.accent::after {
            background: var(--accent);
        }
        
        .stat-card.success::after {
            background: var(--success);
        }
        
        .games-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 10px 15px rgba(0,0,0,0.05);
        }
        
        .section-title {
            font-size: 22px;
            margin-bottom: 20px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .games-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        
        .game-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .game-card h3 {
            font-size: 18px;
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .game-card p {
            color: #666;
            margin-bottom: 15px;
        }
        
        .coin-flip-game {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 10px 15px rgba(0,0,0,0.05);
            margin-top: 30px;
        }
        
        .coin-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 30px 0;
        }
        
        .coin {
            width: 150px;
            height: 150px;
            background: linear-gradient(135deg, #ffd700 0%, #daa520 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            position: relative;
            transform-style: preserve-3d;
        }
        
        .coin::before, .coin::after {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            backface-visibility: hidden;
        }
        
        .coin::before {
            content: 'H';
            background: linear-gradient(135deg, #ffd700 0%, #daa520 100%);
            transform: rotateY(0deg);
        }
        
        .coin::after {
            content: 'T';
            background: linear-gradient(135deg, #daa520 0%, #b8860b 100%);
            transform: rotateY(180deg);
        }
        
        .coin.flipping {
            animation: flip-coin 2s cubic-bezier(0.4, 2.5, 0.6, 0.5);
        }
        
        .bet-options {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            justify-content: center;
        }
        
        .bet-amount {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }
        
        .bet-amount input {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            width: 100px;
            text-align: center;
            font-size: 16px;
        }
        
        .result-message {
            text-align: center;
            font-size: 18px;
            font-weight: 500;
            margin-top: 20px;
            min-height: 27px;
        }
        
        .win {
            color: var(--success);
        }
        
        .lose {
            color: var(--danger);
        }
        
        .marketplace {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 10px 15px rgba(0,0,0,0.05);
            margin-top: 30px;
        }
        
        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .item-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }
        
        .item-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .item-image {
            width: 100%;
            height: 120px;
            background: #ddd;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
        }
        
        .item-info h3 {
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .item-info p {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .item-info .price {
            font-weight: 700;
            color: var(--primary);
            font-size: 18px;
        }
        
        .login-container {
            max-width: 500px;
            margin: 100px auto;
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
            text-align: center;
            animation: fadeInUp 0.5s ease;
        }
        
        .login-container h1 {
            font-size: 28px;
            margin-bottom: 20px;
            color: var(--primary);
        }
        
        .login-container p {
            color: #666;
            margin-bottom: 30px;
        }
        
        .g_id_signin {
            margin: 0 auto;
        }
        
        .hidden {
            display: none;
        }
        
        .floating-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
            transform: translateX(150%);
            transition: transform 0.3s ease;
        }
        
        .floating-notification.show {
            transform: translateX(0);
        }
        
        .notification-success {
            border-left: 4px solid var(--success);
        }
        
        .notification-error {
            border-left: 4px solid var(--danger);
        }
        
        .notification-icon {
            font-size: 24px;
        }
        
        .notification-success .notification-icon {
            color: var(--success);
        }
        
        .notification-error .notification-icon {
            color: var(--danger);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes flip-coin {
            0% {
                transform: rotateY(0);
            }
            50% {
                transform: rotateY(1800deg);
            }
            100% {
                transform: rotateY(3600deg);
            }
        }
        
        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
            }
        }
        
        .pulse {
            animation: pulse 1.5s infinite;
        }
        
        /* Responsive styles */
        @media (max-width: 992px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .games-grid {
                grid-template-columns: 1fr;
            }
            
            header {
                flex-direction: column;
                gap: 20px;
            }
            
            .auth-section {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div id="app">
        <div id="login-page" class="login-container hidden">
            <h1>Economy Simulator Pro</h1>
            <p>Manage your virtual economy, play games, and trade items in this immersive simulation.</p>
            <div id="g_id_onload"
                data-client_id="125868733135-qoe2mfojiuilm4uesbgp11ovjpsmo1cr.apps.googleusercontent.com"
                data-context="signin"
                data-ux_mode="popup"
                data-callback="handleGoogleSignIn"
                data-auto_prompt="false">
            </div>
            <div class="g_id_signin"
                data-type="standard"
                data-shape="pill"
                data-theme="outline"
                data-text="signin_with"
                data-size="large"
                data-logo_alignment="left">
            </div>
        </div>
        
        <div id="dashboard-page" class="hidden">
            <div class="container">
                <header>
                    <div class="logo">
                        <i class="fas fa-coins"></i>
                        <span>Economy</span> Simulator
                    </div>
                    <div class="auth-section">
                        <div class="user-info">
                            <img id="user-avatar" class="user-avatar" src="" alt="User Avatar">
                            <span id="username"></span>
                        </div>
                        <button id="logout-btn" class="btn-danger">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </header>
                
                <div class="main-content">
                    <div class="sidebar">
                        <ul class="sidebar-menu">
                            <li>
                                <a href="#" class="active" data-section="dashboard">
                                    <i class="fas fa-home"></i> Dashboard
                                </a>
                            </li>
                            <li>
                                <a href="#" data-section="marketplace">
                                    <i class="fas fa-store"></i> Marketplace
                                </a>
                            </li>
                            <li>
                                <a href="#" data-section="games">
                                    <i class="fas fa-gamepad"></i> Games
                                </a>
                            </li>
                            <li>
                                <a href="#" data-section="inventory">
                                    <i class="fas fa-box-open"></i> Inventory
                                </a>
                            </li>
                            <li>
                                <a href="#" data-section="leaderboard">
                                    <i class="fas fa-trophy"></i> Leaderboard
                                </a>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="dashboard">
                        <div id="dashboard-section">
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <h3>Balance</h3>
                                    <p id="balance">$0</p>
                                </div>
                                <div class="stat-card accent">
                                    <h3>Net Worth</h3>
                                    <p id="net-worth">$0</p>
                                </div>
                                <div class="stat-card success">
                                    <h3>Daily Income</h3>
                                    <p id="daily-income">$0</p>
                                </div>
                            </div>
                            
                            <div class="games-section">
                                <h2 class="section-title">
                                    <i class="fas fa-gamepad"></i> Quick Games
                                </h2>
                                <div class="games-grid">
                                    <div class="game-card" data-game="coin-flip">
                                        <h3>Coin Flip</h3>
                                        <p>50/50 chance to double your bet</p>
                                        <button class="btn-accent">Play Now</button>
                                    </div>
                                    <div class="game-card" data-game="slots">
                                        <h3>Slots</h3>
                                        <p>Try your luck with the slot machine</p>
                                        <button class="btn-accent">Play Now</button>
                                    </div>
                                    <div class="game-card" data-game="blackjack">
                                        <h3>Blackjack</h3>
                                        <p>Beat the dealer to win big</p>
                                        <button class="btn-accent">Play Now</button>
                                    </div>
                                    <div class="game-card" data-game="dice">
                                        <h3>Dice Roll</h3>
                                        <p>Roll higher than the dealer to win</p>
                                        <button class="btn-accent">Play Now</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="marketplace">
                                <h2 class="section-title">
                                    <i class="fas fa-store"></i> Featured Items
                                </h2>
                                <div class="items-grid" id="featured-items">
                                    <!-- Items will be loaded here -->
                                </div>
                            </div>
                        </div>
                        
                        <div id="coin-flip-section" class="hidden">
                            <div class="coin-flip-game">
                                <h2 class="section-title">
                                    <i class="fas fa-coins"></i> Coin Flip Game
                                </h2>
                                <p>Choose Heads or Tails, place your bet, and flip the coin. Win double your bet if you guess correctly!</p>
                                
                                <div class="coin-container">
                                    <div class="coin" id="coin">
                                        <span>H</span>
                                    </div>
                                    
                                    <div class="bet-options">
                                        <button id="bet-heads" class="btn-primary">
                                            <i class="fas fa-head-side-virus"></i> Heads
                                        </button>
                                        <button id="bet-tails" class="btn-secondary">
                                            <i class="fas fa-coin"></i> Tails
                                        </button>
                                    </div>
                                    
                                    <div class="bet-amount">
                                        <span>Bet Amount:</span>
                                        <input type="number" id="bet-amount" min="10" value="100">
                                    </div>
                                    
                                    <button id="flip-coin" class="btn-accent">
                                        <i class="fas fa-sync-alt"></i> Flip Coin
                                    </button>
                                    
                                    <div class="result-message" id="result-message"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="marketplace-section" class="hidden">
                            <div class="marketplace">
                                <h2 class="section-title">
                                    <i class="fas fa-store"></i> Marketplace
                                </h2>
                                <div class="items-grid" id="marketplace-items">
                                    <!-- Marketplace items will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="notification" class="floating-notification">
            <div class="notification-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="notification-content">
                <h4>Success</h4>
                <p>Your action was completed successfully.</p>
            </div>
        </div>
    </div>

    <script>
        // Supabase configuration
        const supabaseUrl = 'https://rdomgvvjbjfrvkbhjxds.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJkb21ndnZqYmpmcnZrYmhqeGRzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM2MjY5NTEsImV4cCI6MjA2OTIwMjk1MX0.3CMfwZ_HocNzkyvuYjvFL3lypZX2JL2kXvk3kL5AB54';
        const { createClient } = supabase;
const supabaseClient = createClient(supabaseUrl, supabaseKey);
        
        // App state
        let user = null;
        let userData = {
            balance: 1000,
            netWorth: 1000,
            dailyIncome: 50,
            inventory: []
        };
        
        // DOM elements
        const loginPage = document.getElementById('login-page');
        const dashboardPage = document.getElementById('dashboard-page');
        const userAvatar = document.getElementById('user-avatar');
        const usernameSpan = document.getElementById('username');
        const logoutBtn = document.getElementById('logout-btn');
        const balanceElement = document.getElementById('balance');
        const netWorthElement = document.getElementById('net-worth');
        const dailyIncomeElement = document.getElementById('daily-income');
        const notification = document.getElementById('notification');
        const coin = document.getElementById('coin');
        const betHeadsBtn = document.getElementById('bet-heads');
        const betTailsBtn = document.getElementById('bet-tails');
        const flipCoinBtn = document.getElementById('flip-coin');
        const betAmountInput = document.getElementById('bet-amount');
        const resultMessage = document.getElementById('result-message');
        const featuredItemsGrid = document.getElementById('featured-items');
        const marketplaceItemsGrid = document.getElementById('marketplace-items');
        
        // Game state
        let currentBet = null;
        let currentBetAmount = 100;
        let isFlipping = false;
        
        // Sample items data
        const items = [
            { id: 1, name: 'Small House', description: 'A cozy starter home', price: 5000, image: '🏠' },
            { id: 2, name: 'Business', description: 'Small local business', price: 15000, image: '🏢' },
            { id: 3, name: 'Luxury Car', description: 'High-end vehicle', price: 80000, image: '🚗' },
            { id: 4, name: 'Yacht', description: 'Luxury boat', price: 200000, image: '🛥️' },
            { id: 5, name: 'Private Island', description: 'Your own paradise', price: 5000000, image: '🏝️' },
            { id: 6, name: 'Stock Package', description: 'Diversified stocks', price: 10000, image: '📈' },
            { id: 7, name: 'Gold Bar', description: '1kg pure gold', price: 60000, image: '🥇' },
            { id: 8, name: 'Diamond', description: 'Rare gemstone', price: 25000, image: '💎' }
        ];
        
        // Initialize the app
        function init() {
            setupEventListeners();
            checkAuthState();
            renderFeaturedItems();
            renderMarketplaceItems();
        }
        
        // Set up event listeners
        function setupEventListeners() {
            // Navigation
            document.querySelectorAll('.sidebar-menu a').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const section = link.getAttribute('data-section');
                    showSection(section);
                    
                    // Update active state
                    document.querySelectorAll('.sidebar-menu a').forEach(item => {
                        item.classList.remove('active');
                    });
                    link.classList.add('active');
                });
            });
            
            // Game cards
            document.querySelectorAll('.game-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    const game = card.getAttribute('data-game');
                    if (game === 'coin-flip') {
                        showSection('coin-flip');
                    } else {
                        showNotification('Coming soon!', 'This game is under development.', 'info');
                    }
                });
            });
            
            // Coin flip game
            betHeadsBtn.addEventListener('click', () => {
                currentBet = 'heads';
                betHeadsBtn.classList.add('pulse');
                betTailsBtn.classList.remove('pulse');
            });
            
            betTailsBtn.addEventListener('click', () => {
                currentBet = 'tails';
                betTailsBtn.classList.add('pulse');
                betHeadsBtn.classList.remove('pulse');
            });
            
            flipCoinBtn.addEventListener('click', flipCoin);
            
            betAmountInput.addEventListener('change', (e) => {
                currentBetAmount = parseInt(e.target.value) || 100;
                if (currentBetAmount < 10) {
                    currentBetAmount = 10;
                    e.target.value = 10;
                }
                if (currentBetAmount > userData.balance) {
                    currentBetAmount = userData.balance;
                    e.target.value = userData.balance;
                    showNotification('Warning', "You can't bet more than your balance.", 'warning');
                }
            });
            
            // Logout
            logoutBtn.addEventListener('click', logout);
        }
        
        // Check authentication state
        async function checkAuthState() {
            const { data: { session } } = await supabase.auth.getSession();
            
            if (session) {
                user = session.user;
                await loadUserData();
                showDashboard();
            } else {
                showLogin();
            }
        }
        
        // Handle Google sign-in
        async function handleGoogleSignIn(response) {
            const { data, error } = await supabase.auth.signInWithIdToken({
                provider: 'google',
                token: response.credential
            });
            
            if (error) {
                showNotification('Error', 'Failed to sign in with Google.', 'error');
                console.error(error);
                return;
            }
            
            user = data.user;
            await loadUserData();
            showDashboard();
        }
        
        // Load user data from Supabase
        async function loadUserData() {
            // Check if user data exists
            const { data: existingData, error: fetchError } = await supabase
                .from('users')
                .select('*')
                .eq('user_id', user.id)
                .single();
            
            if (fetchError && fetchError.code !== 'PGRST116') { // Ignore "No rows found" error
                console.error('Error fetching user data:', fetchError);
                return;
            }
            
            if (existingData) {
                userData = existingData.data;
            } else {
                // Create new user data with default values
                const { error: insertError } = await supabase
                    .from('users')
                    .insert([{
                        user_id: user.id,
                        email: user.email,
                        data: userData
                    }]);
                
                if (insertError) {
                    console.error('Error creating user data:', insertError);
                    return;
                }
            }
            
            updateUI();
        }
        
        // Save user data to Supabase
        async function saveUserData() {
            const { error } = await supabase
                .from('users')
                .update({
                    data: userData
                })
                .eq('user_id', user.id);
            
            if (error) {
                console.error('Error saving user data:', error);
            }
        }
        
        // Update UI with user data
        function updateUI() {
            // User info
            if (user.user_metadata && user.user_metadata.avatar_url) {
                userAvatar.src = user.user_metadata.avatar_url;
            } else if (user.identities && user.identities[0].identity_data.avatar_url) {
                userAvatar.src = user.identities[0].identity_data.avatar_url;
            }
            
            usernameSpan.textContent = user.email;
            
            // Economy stats
            balanceElement.textContent = `$${userData.balance.toLocaleString()}`;
            netWorthElement.textContent = `$${userData.netWorth.toLocaleString()}`;
            dailyIncomeElement.textContent = `$${userData.dailyIncome.toLocaleString()}`;
        }
        
        // Show login page
        function showLogin() {
            loginPage.classList.remove('hidden');
            dashboardPage.classList.add('hidden');
        }
        
        // Show dashboard
        function showDashboard() {
            loginPage.classList.add('hidden');
            dashboardPage.classList.remove('hidden');
            showSection('dashboard');
        }
        
        // Show specific section
        function showSection(section) {
            // Hide all sections
            document.querySelectorAll('[id$="-section"]').forEach(el => {
                el.classList.add('hidden');
            });
            
            // Show requested section
            const sectionElement = document.getElementById(`${section}-section`);
            if (sectionElement) {
                sectionElement.classList.remove('hidden');
            }
        }
        
        // Logout
        async function logout() {
            const { error } = await supabase.auth.signOut();
            if (error) {
                showNotification('Error', 'Failed to logout.', 'error');
                console.error(error);
                return;
            }
            
            user = null;
            showLogin();
        }
        
        // Coin flip game logic
        function flipCoin() {
            if (isFlipping) return;
            
            if (!currentBet) {
                showNotification('Warning', 'Please select Heads or Tails first.', 'warning');
                return;
            }
            
            if (currentBetAmount > userData.balance) {
                showNotification('Error', "You don't have enough balance for this bet.", 'error');
                return;
            }
            
            // Deduct bet amount
            userData.balance -= currentBetAmount;
            updateUI();
            saveUserData();
            
            // Disable buttons during flip
            isFlipping = true;
            flipCoinBtn.disabled = true;
            betHeadsBtn.disabled = true;
            betTailsBtn.disabled = true;
            resultMessage.textContent = '';
            resultMessage.className = 'result-message';
            
            // Start flip animation
            coin.classList.add('flipping');
            
            // Determine result after animation
            setTimeout(() => {
                const isWinner = Math.random() > 0.5; // 50% chance
                const result = isWinner ? currentBet : (currentBet === 'heads' ? 'tails' : 'heads');
                
                // Show result
                if (result === 'heads') {
                    coin.textContent = 'H';
                } else {
                    coin.textContent = 'T';
                }
                
                // End animation
                coin.classList.remove('flipping');
                
                // Re-enable buttons
                setTimeout(() => {
                    isFlipping = false;
                    flipCoinBtn.disabled = false;
                    betHeadsBtn.disabled = false;
                    betTailsBtn.disabled = false;
                    
                    // Handle win/lose
                    if (isWinner) {
                        const winnings = currentBetAmount * 2;
                        userData.balance += winnings;
                        userData.netWorth += (winnings - currentBetAmount);
                        resultMessage.textContent = `You won $${winnings.toLocaleString()}!`;
                        resultMessage.classList.add('win');
                        showNotification('Winner!', `You won $${winnings.toLocaleString()}!`, 'success');
                    } else {
                        resultMessage.textContent = `You lost $${currentBetAmount.toLocaleString()}.`;
                        resultMessage.classList.add('lose');
                        showNotification('Sorry!', `You lost $${currentBetAmount.toLocaleString()}.`, 'error');
                    }
                    
                    updateUI();
                    saveUserData();
                }, 100);
            }, 2000);
        }
        
        // Render featured items
        function renderFeaturedItems() {
            featuredItemsGrid.innerHTML = '';
            
            // Show first 4 items as featured
            items.slice(0, 4).forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'item-card';
                itemElement.innerHTML = `
                    <div class="item-image">${item.image}</div>
                    <div class="item-info">
                        <h3>${item.name}</h3>
                        <p>${item.description}</p>
                        <div class="price">$${item.price.toLocaleString()}</div>
                        <button class="btn-accent buy-btn" data-id="${item.id}">
                            <i class="fas fa-shopping-cart"></i> Buy
                        </button>
                    </div>
                `;
                
                featuredItemsGrid.appendChild(itemElement);
            });
            
            // Add event listeners to buy buttons
            document.querySelectorAll('.buy-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const itemId = parseInt(btn.getAttribute('data-id'));
                    buyItem(itemId);
                });
            });
        }
        
        // Render marketplace items
        function renderMarketplaceItems() {
            marketplaceItemsGrid.innerHTML = '';
            
            items.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'item-card';
                itemElement.innerHTML = `
                    <div class="item-image">${item.image}</div>
                    <div class="item-info">
                        <h3>${item.name}</h3>
                        <p>${item.description}</p>
                        <div class="price">$${item.price.toLocaleString()}</div>
                        <button class="btn-accent buy-btn" data-id="${item.id}">
                            <i class="fas fa-shopping-cart"></i> Buy
                        </button>
                    </div>
                `;
                
                marketplaceItemsGrid.appendChild(itemElement);
            });
            
            // Add event listeners to buy buttons
            document.querySelectorAll('.buy-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const itemId = parseInt(btn.getAttribute('data-id'));
                    buyItem(itemId);
                });
            });
        }
        
        // Buy item logic
        function buyItem(itemId) {
            const item = items.find(i => i.id === itemId);
            
            if (!item) {
                showNotification('Error', 'Item not found.', 'error');
                return;
            }
            
            if (userData.balance < item.price) {
                showNotification('Error', 'Not enough balance to purchase this item.', 'error');
                return;
            }
            
            // Deduct price from balance
            userData.balance -= item.price;
            
            // Add to inventory
            if (!userData.inventory) userData.inventory = [];
            userData.inventory.push(item);
            
            // Update net worth (items retain full value in this simple simulation)
            userData.netWorth += item.price;
            
            updateUI();
            saveUserData();
            showNotification('Success', `You purchased ${item.name} for $${item.price.toLocaleString()}!`, 'success');
        }
        
        // Show notification
        function showNotification(title, message, type = 'success') {
            const notificationContent = notification.querySelector('.notification-content');
            const notificationIcon = notification.querySelector('.notification-icon i');
            
            // Set content
            notificationContent.innerHTML = `<h4>${title}</h4><p>${message}</p>`;
            
            // Set style based on type
            notification.className = 'floating-notification';
            notification.classList.add(`notification-${type}`);
            notification.classList.add('show');
            
            // Set icon based on type
            notificationIcon.className = type === 'error' ? 'fas fa-exclamation-circle' : 
                                         type === 'warning' ? 'fas fa-exclamation-triangle' :
                                         type === 'info' ? 'fas fa-info-circle' :
                                         'fas fa-check-circle';
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }
        
        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
